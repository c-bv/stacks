version: '3.7'

services:
    traefik:
        image: traefik:v2.10
        container_name: traefik
        command:
            #- --log.level=DEBUG
            - --api.dashboard=true

            - --providers.docker=true
            - --providers.docker.exposedbydefault=false

            - --entrypoints.web.address=:80
            - --entrypoints.websecure.address=:443
            - --entrypoints.web.http.redirections.entryPoint.to=websecure

            - --certificatesresolvers.myresolver.acme.dnschallenge=true
            - --certificatesresolvers.myresolver.acme.dnschallenge.provider=ovh
            - --certificatesresolvers.myresolver.acme.email=system@charlesbouveret.dev
            - --certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json
        ports:
            - 80:80
            - 443:443
        env_file:
            - .env
        volumes:
            - ./letsencrypt:/letsencrypt
            - /var/run/docker.sock:/var/run/docker.sock:ro
networks:
    default:
        name: traefik
